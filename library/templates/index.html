{% extends "layout.html" %}

{% block headline %}

{% if flag == 'books_list' or flag == 'books_by_letter' %}
<a class="float-right" href="{{ url_for('main.search_books', flag='books_list') }}" style="text-decoration:none"> üîç
</a>
<a href="{{ url_for('main.home', flag='authors_list')}}" style="text-decoration:none; color:black">Books</a>
<a style="text-decoration:none; color:rgb(9, 145, 9)" href="{{ url_for('book.add_title') }}"> +</a>
<a style="color: red; text-decoration:none" href="{{ url_for('main.search_books') }}">-</a>

{% elif flag == 'authors_list' or flag == 'authors_by_letter' %}
<a class="float-right" href="{{ url_for('main.search_authors', flag='authors_list') }}" style="text-decoration:none"> üîç
</a>
<a href="{{ url_for('main.home', flag='publishers_list')}}" style="text-decoration:none; color:rgb(0, 0, 0)">Authors</a>
<a style="text-decoration:none; color:rgb(9, 145, 9)" href="{{ url_for('author.add_author') }}"> +</a>
<a style="color: red; text-decoration:none" href="{{ url_for('main.search_authors', flag='authors_list') }}">-</a>

{% elif flag == 'publishers_list' or flag == 'publishers_by_letter' %}
<a class="float-right" href="{{ url_for('main.search_publishers', flag='publishers_list') }}"
    style="text-decoration:none"> üîç
</a>
<a href="{{ url_for('main.home', flag='books_list')}}" style="text-decoration:none; color:rgb(0, 0, 0)">Publishers</a>
<a style="text-decoration:none; color:rgb(9, 145, 9)" href="{{ url_for('publisher.add_publisher') }}"> +</a>
<a style="color: red; text-decoration:none" href="{{ url_for('main.search_publishers', flag='publishers_list') }}">-</a>
{% endif %}
{% endblock %}

{%block subhead %}
<hr />
&nbsp;{{ total }} <a style="text-decoration:none; color:cadetblue"
    href="{{ url_for('main.home', flag='books_list') }}">books</a> - {{ total_auth }} <a
    style="text-decoration:none; color:cadetblue" href="{{ url_for('main.home', flag='authors_list') }}">authors</a> -
{{ total_publishers }} <a style="text-decoration:none; color:cadetblue"
    href="{{ url_for('main.home', flag='publishers_list') }}">publishers</a> in Total

{% if not not_show_limit %}
<form class="float-right" method="POST" " novalidate>  
    {{ form.csrf_token }}
    {{ form.limit(size=5, class="pb-0 align-middle mt0") }}
    {{ form.submit(class="btn btn-warning btn-sm align-middle mt0", style="color:black; --bs-btn-font-size: .75rem") }}
</form>
{% endif %}

{% endblock subhead %}

{% block a_z %}
{% if flag == 'authors_by_letter' or flag == 'authors_list' %}
{% set url = 'author.authors_by_letter' %}
{% elif flag == 'books_by_letter' or flag == 'books_list' %}
{% set url = 'book.books_by_letter' %}
{% elif flag == 'publishers_by_letter' or flag == 'publishers_list' %}
{% set url = 'publisher.publishers_by_letter' %}
{% endif %}
{% with letter=letter %}
{% include 'a_z.html' %}
{% endwith %}
{% endblock a_z %}

{%block content %}
<br><br><br><br><br><br><br><br><br><br><br><br><br><br>
{% if flag =='books_list' %}
<ul>
    {% if books|count == 0 %}
    <h4 style=" color:red">Library is empty</h4>
    {% elif books|count != 0 %}
        {% for letter in letters %}
            {% set ttl='books' if books_by_letter|count != 1 else 'book' %}
            {% set ns=namespace(author_number=0, book_number=0) %}
            {% for author in authors %}
                {% if author.lname.startswith(letter) %}
                    {% for book in author.books %}
                        {% if book.title.startswith(letter) %}
                            {% set ns.author_number = ns.author_number + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
            {% if ns.author_number > 0 %}
                <h6>{{ letter }}</h6>
                <hr/>
            {% endif %}
            
            {% for author in authors %}
                {% set ns.book_number = 0 %}
                    {# Count how many book starting from said letter the author has #}
                    {% for book in author.books %}
                        {% if book.title.startswith(letter) %}
                            {% set ns.book_number = ns.book_number + 1 %}
                        {% endif %}
                    {% endfor %}               
                {% if ns.book_number > 0 %}
                    <h6>{{author.fullname}} <a style="text-decoration:none"
                        href="{{ url_for('author.bibliography', author=author.fullname) }}">
                        {{ ns.book_number }}
                        books</a> in collection</h6>
                {% endif %}

                    {# List the books of the author #}  
                    {% for book in author.books %}
                        {% if book.title.startswith(letter) %}
                            {% if ns.book_number < limit and limit != 0 %}
                                {% set ns.book_number = ns.book_number + 1 %}
                            {% include 'books/list_author_books.html' %}
                            {% elif limit == 0 %}
                            {% include 'books/list_author_books.html' %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    {% if ns.book_number > 0 %}
                    <br/>
                    {% endif %}               
            {% endfor %}
            <br/>
        {% endfor %}
    {% endif %}
    </ul>
    {% elif flag == 'books_by_letter' %}
    <ul>
        {% if books_by_letter|count == 0 %}
        <h4 style="color:red">Library is empty</h4>
        {% else %}
            <h6>{{ letter }} - 
            {% set ttl='books' if books_by_letter|count != 1 else 'book' %}
            {{ books_by_letter|length }} {{ ttl }} by {{ authors_count }} authors found</h6>
            <br/>
            
            {% for author_letter in letters %}
                {% for author in authors %}
                    {% if author.lname.startswith(author_letter) %}
                        {% set ns=namespace(book_number=0) %}
                        {% for book in author.books %}
                            {% if book.title.startswith(letter) or letter == '*' %}
                                {% set ns.book_number=ns.book_number+1 %}
                            {% endif %}
                        {% endfor %}
                            
                        {% if ns.book_number > 0 %}
                            <h6>{{author.fullname}} <a style="text-decoration:none"
                            href="{{ url_for('author.bibliography', author=author.fullname) }}">
                            {{ns.book_number}}
                            books</a></h6>
                        {% endif %}
                            
                        {% for book in author.books %}
                            {% if book.title.startswith(letter) %}
                            {% include 'books/list_author_books.html' %}
                            {% endif %}
                            {% if letter == '*' %}
                                {% include 'books/list_author_books.html' %}
                            {% endif %}
                        {% endfor %}
                        {% if ns.book_number > 0 %}
                            <br>
                        {% endif %}   
                    {% endif %}
                {% endfor %}
            
            {% endfor %}
        {% endif %}
    </ul>

    {% elif flag == 'authors_list' %}
    <ul>
        {% if authors|count == 0 %}
            <h4 style="color:red">Library is empty</h4>
        {% endif %}

        {% if authors|count != 0 %}
            {% for letter in letters %}

                {# Calculating Number of Authors for current letter #}
                {% set ns = namespace(author_number = 0,author_limit_number = 0) %}
                {% for author in authors %}
                    {% if author.lname.startswith(letter) %}
                        {% set ns.author_number=ns.author_number+1 %}
                    {% endif %}
                {% endfor %}
                
                {% set auth='authors' if ns.author_number != 1 else 'author' %}
                <h6 style="color:black; font-weight:bold">{{ letter }} - {{ns.author_number}} {{ auth }} found</h6>

                {# List Authors for current letter #}
                {% set ns.author_limit_number = 0 %}
                {% for author in authors %}
                    {% if author.lname.startswith(letter) %}
                        {% if ns.author_limit_number < limit and limit != 0 %}
                            {% set ns.author_limit_number = ns.author_limit_number + 1 %}
                            {% include 'authors/list_authors_per_letter.html' %}
                        {% elif limit == 0 %}
                            {% include 'authors/list_authors_per_letter.html' %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
                <br>
            {% endfor %}
        {% endif %}
    </ul>

    {% elif flag == 'authors_by_letter' %}
    <ul>
        {% if authors_by_letter|count == 0 %}
        <h4 style="color:red">Library is empty</h4>

        {% else %}

        {# Calculating Number of Authors for current letter if letter IS NOT '*' #}
        {% set auth='authors' if authors_by_letter|count != 1 else 'author' %}
        <h6>{{ authors_by_letter|length }} {{ auth }} found</h6>
        
        {% if letter == '*' %}
        {% for letter in letters %}

        {# Calculating Number of Authors for current letter if letter IS '*' #}
        {% set ns=namespace(author_number=0) %}
        {% for author in authors_by_letter %}
        {% if author.lname.startswith(letter) %}
        {% set ns.author_number=ns.author_number+1 %}
        {% endif %}
        {% endfor %}
        {% set auth='authors' if ns.author_number != 1 else 'author' %}
        <h6 style="color:black; font-weight:bold">{{ letter }} - {{ns.author_number}} {{ auth }} found</h6>
        
        {# List Authors for current letter if letter IS '*' #}
        {% for author in authors_by_letter %}
        {% if author.lname.startswith(letter) %}
        {% include 'authors/list_authors_per_asterisk.html' %}
        {% endif %}
        {% endfor %}
        <br>
        {% endfor %}
        {% endif %}

        {# List Authors for current letter if letter IS NOT '*' #}
        {% if letter != '*' %}
        {% for author in authors_by_letter %}
        {% include 'authors/list_authors_per_asterisk.html' %}
        {% endfor %}
        {% endif %}
        {% endif %}
    </ul>

    {% elif flag == 'publishers_list' %}
    <ul>
        {% if publishers|count == 0 %}
        <h4 style="color:red">Library is empty</h4>

        {% else %}

        {% for letter in letters %}

        {# Calculating Number of Publishers for current letter #}
        {% set ns=namespace(publisher_number=0) %}
        {% for publisher in publishers %}
        {% if publisher.publ_name.startswith(letter) %}
        {% set ns.publisher_number=ns.publisher_number+1 %}
        {% endif %}
        {% endfor %}
        {% set publ='publishers' if ns.publisher_number != 1 else 'publisher' %}
        <h6 style="color:black; font-weight:bold">{{ letter }} - {{ns.publisher_number}} {{ publ }} found</h6>

        {# List Publishers for current letter #}
        {% for publisher in publishers %}
        {% if publisher.publ_name.startswith(letter) %}
        
        {% include 'publishers/publishers_by_letter.html' %}
        
        {% endif %}
        {% endfor %}
        <br/>
        {% endfor %}
        {% endif %}
    </ul>
    {% elif flag == 'publishers_by_letter' %}
    <ul>
        {% if publishers_by_letter|count == 0 %}
        <h4 style="color:red">Library is empty</h4>

        {% else %}

        {# Calculating Number of Publishers for current letter if letter IS NOT '*' #}
        {% set publ='publishers' if publishers_by_letter|count != 1 else 'publisher' %}
        <h6>{{ publishers_by_letter|length }} {{ publ }} found</h6>

        {% if letter == '*' %}
        {% for letter in letters %}

        {# Calculating Number of Publishers for current letter #}
        {% set ns=namespace(publisher_number=0) %}
        {% for publisher in publishers_by_letter %}
        {% if publisher.publ_name.startswith(letter) %}
        {% set ns.publisher_number=ns.publisher_number+1 %}
        {% endif %}
        {% endfor %}
        {% set publ='publishers' if ns.publisher_number != 1 else 'publisher' %}
        <h6 style="color:black; font-weight:bold">{{ letter }} - {{ns.publisher_number}} {{ publ }} found</h6>

        {# List Publishers for current letter if letter IS '*' #}
        {% for publisher in publishers_by_letter %}
        {% if publisher.publ_name.startswith(letter) %}
        
        {% include 'publishers/publishers_by_letter.html' %}
        
        {% endif %}
        {% endfor %}
        <br/>
        {% endfor %}
        {% endif %}

        {# List Publishers for current letter if letter IS NOT '*' #}
        {% if letter != '*' %}
        {% for publisher in publishers_by_letter %}

        {% include 'publishers/publishers_by_letter.html' %}
        
        {% endfor %}
        {% endif %}
        {% endif %}
    </ul>
    {% endif %}
    {% endblock %}
